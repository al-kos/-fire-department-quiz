## **Выполнил**: *Косенко Алексей, группа ИСТ-2022*

### Для реализации данного приложения используются:
* express - веб-фреймворк для Node.js, предоставляет множество полезных функций, таких как маршрутизация, обработка форм, шаблонизация и др.;
* body-parser - библиотека для обрабатки данных форм POST, для парсинга тела запросов;
* cookie-parser - библиотека используется для обработки сессий на стороне сервера. Она позволяет серверу устанавливать, читать и удалять cookies в запросах;
* express-session - библиотека  для управления сессиями на стороне сервера. Она позволяет серверу сохранять состояние сессии между запросами;
* pg - библиотека для работы с базой данных PostgreSQL. Она предоставляет API для выполнения SQL-запросов к базе данных PostgreSQL;
* connect-pg-simple -библиотека для хранения данных сессии в базе данных PostgreSQL;
* bcryptjs - библиотека для криптографического хэширования паролей. Она используется для защиты учетных данных пользователей от кражи или взлома;
* hbs - шаблонизатор для генерации HTML-страниц на основе шаблонов для Express;
* dotenv - библиотека для загрузки переменных окружения из файла .env в процесс приложения Node.js

# Описание функционала приложения

## Серверная часть и база данных

### app.js

`app.js` — основной файл конфигурации и запуска приложения. Здесь подключаются все необходимые модули и библиотеки, настраиваются middleware, маршруты и запускается сервер.

#### Основные функции

- Проверка и инициализация базы данных.
- Настройка шаблонизатора Handlebars.
- Обслуживание статических файлов.
- Обработка данных формы POST.
- Управление сессиями и cookies.
- Импорт и применение маршрутов для различных частей приложения.
- Настройка маршрута для главной страницы и запуск сервера.

### db.js

`db.js` — файл для работы с базой данных PostgreSQL, включает функции подключения и инициализации базы данных.

#### Основные функции

- Создание пула соединений с базой данных.
- Инициализация базы данных, включая создание таблиц пользователей, вопросов викторины, результатов викторины и сессий.
- Хэширование паролей и добавление администратора по умолчанию.

## Пользовательский функционал

### Регистрация и вход

#### auth.js

**Регистрация**

- **GET-запрос на `/register`**: отображает форму регистрации.
- **POST-запрос на `/register`**: обрабатывает данные формы регистрации. Пароль хэшируется с помощью bcrypt перед сохранением в базу данных. Проверяется, существует ли уже пользователь с введенным email.

**Вход**

- **GET-запрос на `/login`**: отображает форму входа.
- **POST-запрос на `/login`**: обрабатывает данные формы входа. Проверяет соответствие логина и хэшированного пароля в базе данных.

**Выход**

- **GET-запрос на `/logout`**: удаляет сессию из базы данных и из памяти, а также удаляет cookie с пользователем.

### Интерфейс и страницы

#### layout.hbs

- Определяет общий макет страницы для всех страниц приложения.
- Включает навигационное меню с пунктами в зависимости от того, авторизован ли пользователь.
- Отображает контент каждой страницы.
- Содержит футер с социальными иконками.

#### index.hbs

- Отображает приветствие для зарегистрированных пользователей с их именем и для гостей.
- Содержит описание приложения и его функционала.

#### register.hbs

- Отображает форму регистрации.
- Форма отправляет данные на `/register` методом POST.

#### login.hbs

- Отображает форму входа.
- Форма отправляет данные на `/login` методом POST.
- Выводит ошибку при неправильном логине или пароле и может перенаправлять на страницу регистрации.

### Профиль пользователя

#### profile.js

**Отображение профиля пользователя**

- **GET-запрос на `/profile`**: проверяет наличие пользователя в сессии. Если пользователь не аутентифицирован, он перенаправляется на страницу входа. При наличии данных пользователя в сессии, рендерится страница профиля с его данными.

**Обновление данных пользователя**

- **POST-запрос на `/update`**: обрабатывает изменения данных профиля (логин, email). Данные обновляются в базе данных и в сессии пользователя.

**Удаление учетной записи пользователя**

- **POST-запрос на `/delete`**: удаляет учетную запись пользователя из базы данных. Также удаляются результаты тестирования и данные сессии пользователя. После удаления учетной записи происходит перенаправление на главную страницу.

### Викторина

#### quiz.js

**Отображение вопросов викторины**

- **GET-запрос на `/quiz`**: проверяет наличие пользователя в сессии и наличие данных викторины. Если пользователь не аутентифицирован, он перенаправляется на страницу входа. Если данные викторины отсутствуют, они инициализируются. Запрашиваются вопросы из базы данных и отображается текущий вопрос для пользователя.

**Обработка ответов на вопросы викторины**

- **POST-запрос на `/quiz`**: обрабатывает ответы пользователя на вопросы. Проверяется правильность ответа и увеличивается счетчик правильных ответов. Если викторина завершена, результаты сохраняются в базе данных и в сессии пользователя. После завершения викторины происходит перенаправление на страницу результатов.

### Результаты викторины

#### result.js

**Отображение результатов викторины**

- **GET-запрос на `/result`**: проверяет наличие пользователя в сессии. Если пользователь не аутентифицирован, он перенаправляется на страницу входа. Запрашиваются результаты последней викторины пользователя из базы данных. Если результаты есть, они отображаются на странице результатов. Если результатов нет, выводится информация о их отсутствии.

#### result.hbs

- Если результаты отсутствуют, отображается соответствующее сообщение и кнопка для возврата на главную страницу.
- Если результаты есть, отображается количество вопросов и количество правильных ответов, а также кнопка для возврата на главную страницу.

## Административный функционал

### Страница администратора

#### admin.js

**Страница администратора**

- **GET-запрос на `/admin`**: проверяет наличие пользователя с правами администратора в сессии. Если пользователь не аутентифицирован или не является администратором, он перенаправляется на страницу входа. Рендеринг шаблона администратора с приветствием и именем пользователя.

#### admin.hbs

- Отображает приветствие администратора.

### Редактирование викторины

#### edit-quiz.js

**Страница редактирования викторины**

- **GET-запрос на `/edit-quiz`**: проверяет наличие пользователя с правами администратора в сессии. Если пользователь не аутентифицирован или не является администратором, он перенаправляется на страницу входа.
### Редактирование викторины

**POST-запрос на `/edit-quiz/add`**

- Получает данные из тела запроса, включая вопрос, варианты ответов и правильный ответ.
- Вставляет новый вопрос в базу данных.
- Перенаправляет на страницу редактирования викторины в случае успешного добавления вопроса.
- В случае ошибки выводит сообщение об ошибке.

**POST-запрос на `/edit-quiz/update/:id`**

- Получает ID вопроса из параметров запроса и новые данные вопроса из тела запроса.
- Обновляет вопрос в базе данных.
- Перенаправляет на страницу редактирования викторины в случае успешного обновления вопроса.
- В случае ошибки выводит сообщение об ошибке.

**POST-запрос на `/edit-quiz/delete/:id`**

- Получает ID вопроса из параметров запроса.
- Удаляет вопрос из базы данных.
- Перенаправляет на страницу редактирования викторины в случае успешного удаления вопроса.
- В случае ошибки выводит сообщение об ошибке.
